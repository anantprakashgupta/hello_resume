<!DOCTYPE html>
<!-- Coding By CodingNepal - codingnepalweb.com -->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ===== CSS ===== -->
    <!-- <link rel="stylesheet" href="/assets/css/resume_form.css"> -->
    <link rel="stylesheet" href="/assets/css/navbar_blue.css">
    <link rel="stylesheet" href="/assets/css/hand.css">
    <script src="/assets/js/min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css">

    <!-- ===== Boxicons CSS ===== -->
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>

    <title>Resume Form</title>
</head>
<style>
    /* .container4 {
    background-color: #ffffff;
    width: 70%;
    min-width: 420px;
    padding: 35px 50px;
    transform: translate(-50%, -50%);
    position: absolute;
    left: 50%;
    top: 50%;
    border-radius: 10px;
    box-shadow: 20px 30px 25px rgba(0, 0, 0, 0.15);
    margin-top: 630px;
  
  } */
    .container4 {
        background-color: #ffffff;
        width: 70%;
        min-width: 420px;
        padding: 35px 50px;
        transform: translate(-50%, -50%);
        position: absolute;
        left: 50%;
        top: 50%;
        border-radius: 10px;
        box-shadow: 20px 30px 25px rgba(0, 0, 0, 0.15);
        margin-top: 5vh;
        /* Adjust this value as needed */
    }


    h1 {
        font-size: 30px;
        text-align: center;
        color: #1c093c;
    }

    p {
        position: relative;
        margin: auto;
        width: 100%;
        text-align: center;
        color: #606060;
        font-size: 14px;
        font-weight: 400;
    }

    #f_o_r_m form {
        width: 100%;
        position: relative;
        margin: 30px auto 0 auto;
    }

    .row {
        width: 100%;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        grid-gap: 20px 30px;
        margin-bottom: 20px;
    }

    label {
        color: #1c093c;
        font-size: 14px;
    }

    textarea,
    input,
    select {
        width: 100%;
        font-weight: 400;
        padding: 8px 10px;
        border-radius: 5px;
        border: 1.2px solid #c4cae0;
        margin-top: 5px;
    }


    textarea {
        resize: none;
    }

    textarea:focus,
    input:focus {
        outline: none;
        border-color: #6f6df4;
    }

    button {
        border: none;
        padding: 10px 20px;
        /* background: linear-gradient(130deg, */
        color: #ffffff;
        border-radius: 3px;
        width: 100%;
    }
    button:hover {
    background-color: #2b0b63;
}


</style>

<body>
    <nav>
        <div class="nav-bar">
            <i class='bx bx-menu sidebarOpen'></i>
            <span class="logo navLogo"><a href="/user" style="font-size: 15px;">HELLO <span style="color: red;">RESUME
            <img src="/assets/images/hand2.png" style="font-size: 20px; width:20px;" class="hand-image"> </img></span>
                </a></span>

            <div class="menu">
                <div class="logo-toggle">
                    <span class="logo navLogo"><a href="/user" style="font-size: 15px;">HELLO <span
                                style="color: red;">RESUME ðŸ‘‹</span>
                        </a></span>
                    <i class='bx bx-x siderbarClose'></i>
                </div>

                <ul class="nav-links">
                    <li><a href="/user">Home</a></li>
                    <li><a href="/about">About</a></li>
                    <li><a href="/show_resume">Resume</a></li>
                    <li><a href="#">user count <span id="userCount"></span></a></li>
                    <li><a href="" onclick="logout()">Logout</a></li>
                    <li><a href="" id="username_dp" style="color: rgb(27, 255, 6);"></a></li>
                    <!-- <div class="navProfile">
                        <img src="" id="" alt="Profile Picture">
                    </div> -->
                </ul>
            </div>

            <div class="darkLight-searchBox">
                <div class="dark-light">
                    <i class='bx bx-moon moon'></i>
                    <i class='bx bx-sun sun'></i>
                </div>

                <div class="searchBox">
                    <div class="searchToggle">
                        <i class='bx bx-x cancel'></i>
                        <i class='bx bx-search search'></i>
                    </div>

                    <div class="search-field">
                        <input type="text" placeholder="Search...">
                        <i class='bx bx-search'></i>
                    </div>
                </div>
            </div>
            <li class="navProfile">
                <a href="/profile_pic"><img src="" id="dp_pic" id="nav-link"></img></a>
            </li>
        </div>
    </nav>
    <!-- ////////////////////////////////////////////// -->
    <div class="container4">
        <h1>Update  Profile</h1>

        <form id="uploadForm" class="f_o_r_m" enctype="multipart/form-data">
            <div class="row">
                <div class="column">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" placeholder="Your name here">
                </div>
                <div class="column">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" placeholder="Your email here">
                </div>
            </div>
                <div class="row">
                    <div class="column">
                        <label for="mobile">Mobile</label>
                        <input type="text" id="mobile" name="mobile" placeholder="Your mobile here">
                    </div>
                    <div class="column">
                        <label for="Password">Password</label>
                        <input type="text" id="password" name="password" placeholder="Your password here">
                    </div>
                </div>
        
            <button type="submit" onclick="save_data()" style="background-color: #4c46f5;">Update Profile info</button>
        </form>

        <form id="Upload_DP" enctype="multipart/form-data">
            <div style="margin-left: 20px;">
                <input type="file" name="profile_pic">
                <!-- <label>Upload image</label> -->
            </div>
            <button onclick="save_dp()" style="background-color: #4c46f5;">Update Profile Pic</button>
        </form>
        <div>
          
            <button onclick="delete_userid()" style="margin-top: 5px; background-color: red;">Delete Account</button>
        </div>

        <!-- //////////////////////////////// -->
    </div>

    <script>

        const body = document.querySelector("body"),
            nav = document.querySelector("nav"),
            modeToggle = document.querySelector(".dark-light"),
            searchToggle = document.querySelector(".searchToggle"),
            sidebarOpen = document.querySelector(".sidebarOpen"),
            siderbarClose = document.querySelector(".siderbarClose");

        let getMode = localStorage.getItem("mode");
        if (getMode && getMode === "dark-mode") {
            body.classList.add("dark");
        }

        // js code to toggle dark and light mode
        modeToggle.addEventListener("click", () => {
            modeToggle.classList.toggle("active");
            body.classList.toggle("dark");

            // js code to keep user selected mode even page refresh or file reopen
            if (!body.classList.contains("dark")) {
                localStorage.setItem("mode", "light-mode");
            } else {
                localStorage.setItem("mode", "dark-mode");
            }
        });

        // js code to toggle search box
        searchToggle.addEventListener("click", () => {
            searchToggle.classList.toggle("active");
        });


        //   js code to toggle sidebar
        sidebarOpen.addEventListener("click", () => {
            nav.classList.add("active");
        });

        body.addEventListener("click", e => {
            let clickedElm = e.target;

            if (!clickedElm.classList.contains("sidebarOpen") && !clickedElm.classList.contains("menu")) {
                nav.classList.remove("active");
            }
        });

    </script>

</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // $(document).ready(function () {
    function save_data() {
        $('#uploadForm').submit(function (e) {
            e.preventDefault();

            var username = $('input[name="username"]').val();
            var mobile = $('input[name="mobile"]').val();
            var email = $('input[name="email"]').val();
            var password = $('input[name="password"]').val();

            $.ajax({
                type: 'POST',
                url: '/profile_update_api',
                data: JSON.stringify({
                    username: username,
                    mobile: mobile,
                    email: email,
                    password: password,

                }),
                contentType: 'application/json',
                success: function (response) {
                    console.log(response);
                    // alert("data insert");
                    swal({
                        title: "Success!",
                        text: "Profile Details updated successfully",
                        icon: "success",
                        timer: 3000, // 3 seconds
                        button: false, // Hide the button
                        closeOnClickOutside: false, // Prevent closing on click outside the alert
                        closeOnEsc: false // Prevent closing on pressing Esc key
                    });
                    // },
                },
                error: function (error) {
                    // Handle error response
                },
            });
        });
        // });
    }
</script>

<script>
    function save_dp() {
        // alert("hhh");
        $('#Upload_DP').submit(function (e) {
            e.preventDefault();

            var fileInput = $('input[name="profile_pic"]')[0].files[0]; // Get the file object

            var reader = new FileReader();
            reader.onloadend = function () {
                var imageBase64 = reader.result; // Get the base64 data

                // Remove the prefix 'data:image/jpeg;base64,'
                var base64Index = imageBase64.indexOf(',') + 1;
                if (base64Index !== -1) {
                    imageBase64 = imageBase64.substring(base64Index);
                }

                $.ajax({
                    type: 'POST',
                    url: '/profile_update_DP',
                    data: JSON.stringify({
                        imageBase64: imageBase64,

                    }),
                    contentType: 'application/json',
                    success: function (response) {
                        console.log(response);
                        swal({
                            title: "Success!",
                            text: "Profile picture updated successfully",
                            icon: "success",
                            timer: 3000, // 3 seconds
                            button: false, // Hide the button
                            closeOnClickOutside: false, // Prevent closing on click outside the alert
                            closeOnEsc: false // Prevent closing on pressing Esc key
                        });
                    },
                    error: function (error) {
                        // Handle error response
                    },
                });
            };

            if (fileInput) {
                reader.readAsDataURL(fileInput); // Read the file as base64
            } else {
                // Handle case when no file is selected
                alert('Please select an image file');
            }
        });
        // });
    }
</script>

<script>
    $(document).ready(function () {
        $.ajax({
            url: '/profile_pic2',
            type: 'GET',
            success: function (images) {
                console.log("data pk", images);
                var name1 = images[0].username;
                var image1 = images[0].data;

                if (image1) {
                    $('#dp_pic').attr('src', `data:image/png;base64,${image1}`);
                } else {
                    // Set default profile picture here
                    $('#dp_pic').attr('src', 'https://cdn.pixabay.com/photo/2020/07/01/12/58/icon-5359553_1280.png');
                }
                $('#username_dp').text(name1);
            },
            error: function () {
                // Handle the error if the AJAX request fails
                console.log('Error occurred while retrieving profile picture.');
            }
        });
    });
</script>
<script>
    // Fetch existing user details via AJAX
    $(document).ready(function () {
        $.ajax({
            url: '/profile_viewData_api',
            method: 'POST',
            success: function (user) {
                console.log("show", user);
                $('#username').val(user.username);
                $('#mobile').val(user.mobile);
                $('#email').val(user.email);
                $('#password').val(user.password);
            },
        });
    })
</script>

<script>
    $(document).ready(function () {
        var User = localStorage.getItem("userid");
        console.log(User);
        if (User == null) {
            window.location.href = "/logIn";
        } else {
            $("#userId").html(User);
        }
    });

    function logout() {
        localStorage.removeItem("userid");
        window.location.href = "/login";
    }

</script>
<script>
    function delete_userid() {
        swal({
            title: "Confirmation",
            text: "Are you sure you want to delete your account?",
            icon: "warning",
            buttons: ["Cancel", "Yes, delete"],
            dangerMode: true,
        }).then((confirmed) => {
            if (confirmed) {
                $.ajax({
                    type: 'POST',
                    url: '/delete_userid',
                    contentType: 'application/json',
                    success: function (response) {
                        console.log("delete data", response);
                        swal("Success!", response, "success").then(() => {
                            logout();
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error(xhr.responseText);
                        swal("Error!", xhr.responseText, "error");
                    }
                });
            }
        });
    }

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    $(document).ready(function () {
        updateUserCount();

        function updateUserCount() {
            $.ajax({
                url: '/user_count',
                success: function (data) {
                    $('#userCount').text(data.userCount);
                }
            });
        }

        // Connect to the WebSocket server
        const socket = io();

        // Update user count when received from the server
        socket.on('userCount', function (userCount) {
            $('#userCount').text(userCount);
        });
    });
</script>

</html>